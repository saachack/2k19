(function(){var g=document.querySelectorAll.bind(document);var q=window.dataLayer=window.dataLayer||[];var j="";var h="";var a=10000;e();var o=window.gtmDebug;o&&(function(){console.log(q,h,j);var w=q.push;q.push=function(){w.apply(q,arguments);console.log(this)}})();if(document.readyState==="complete"||document.readyState==="loaded"){s()}else{document.addEventListener("DOMContentLoaded",function(){s()})}function s(){h=d();j=i();try{t()}catch(w){console.error(w)}}function t(){switch(j){case"home":b(q);break;case"store":u(q);break;case"phoneModels":v(q);break;case"accessoryDetail":m(q);break;case"jcart":f(q);break;case"paymentFail":k(q);break;case"paymentSuccess":p(q);break;case"checkout":c(q);break;default:break}}function c(z){var A;n(function(){return g(".r-product .detail").length>0},function(){var D=g(".r-product .detail");A=Array.prototype.map.call(D,function(E){var H=E.querySelector(".name").getAttribute("data-sku");var G=E&&Number(E.querySelector(".price").getAttribute("data-price"));var F=E.querySelector(".name").textContent;return{id:H,name:F&&F.trim(),price:G,category:C(H,E),quantity:Number(E.querySelector(".num").textContent)}});z.push({"event":"checkoutStep2-onePage","ecomm_prodid":A.map(function(E){return E.id}),"ecomm_category":A.map(function(E){return E.category}),"ecommerce":{"currencyCode":h,"checkout":{"actionField":{"step":2,"option":"One Page"},"products":A}}})},a);y();x();B();w();function y(){var E=g("#id-shipping-address .btn-continue")[0];var D="";E.addEventListener("click",function(){var F=g("#id-shipping-address [name=shipping]:checked");if(F){F=F[0];D=F.value==0?"adding":"choosing";z.push({"event":"checkoutStep3-shippingAddress","ecommerce":{"currencyCode":h,"checkout":{"actionField":{"step":3,"option":D},"products":A}}})}})}function x(){var D=g("#checkout-shipping-method-list .btn-continue")[0];D.addEventListener("click",function(){var E=g("#checkout-shipping-method-list [name=shipmethod]:checked");if(E){E=E[0];z.push({"event":"checkoutStep4-shippingMethod","ecommerce":{"currencyCode":h,"checkout":{"actionField":{"step":4,"option":E.getAttribute("data-name")},"products":A}}})}})}function B(){var D=g("#checkout-payment-method-list .btn-continue")[0];D.addEventListener("click",function(F){if(F.target.classList.contains("disabled")){return}var E=g("#checkout-payment-method-list [name=paymethod]:checked");if(E){E=E[0];z.push({"event":"checkoutStep5-paymentMethod","ecommerce":{"currencyCode":h,"checkout":{"actionField":{"step":5,"option":E.getAttribute("data-name")},"products":A}}})}})}function w(){var D=g("#btn-falcon-place-order")[0];D.addEventListener("click",function(F){var E=F.target.classList.contains("disabled");!E&&z.push({"event":"CheckoutStep6-placeOrder","ecommerce":{"currencyCode":h,"checkout":{"actionField":{"step":6,"option":"Place Order"},"products":A}}})})}function C(E,D){if(l(E)||D.nextElementSibling){return"Device"}else{if(D.classList.contains("b-insurance")){return"Insurance"}else{return D.querySelector(".b-buddle")?"Bundle":"Accessory"}}}}function p(y){var B=location.search.substring(1).split("&")[0].split("=")[1];n(function(){return !!(window.successOrderData&&window.successOrderData.orderNo)&&window.isFirstPaidOrder!==undefined},function(){var F=window.successOrderData;if(!F){return}var G=[];var J=[];F.products.forEach(function(L){var M=L.insurance.length>0;G.push(L);if(M){J=J.concat(L.insurance)}});G=G.concat(J);var K=G.map(function(L){L.category=A(L.sku,L);return L.category});var I=(function E(L){return L.some(function(M){if(l(M.sku)){return true}else{if(M.accessories&&M.accessories.length>0){return E(M.accessories)}}return false})})(G);var D=G.reduce(function(N,M){var O=0;if(l(M.sku)){O=x(M)}else{if(M.accessories&&M.accessories.length>0){var L=M.accessories.some(function(P){return l(P.sku)});O=L?x(M):0}}return +O+N},0);var C=G.reduce(function(M,L){return M+x(L)},0);var H=[];z(F.products,H);y.push({"ecomm_pagetype":"purchase","ecomm_prodid":G.map(function(L){return L.sku}),"ecomm_value":C,"ecomm_category":K});y.push({"event":"Transaction","orderType":I?"device":"default","phoneSaleAmount":D,"accessorySaleAmount":(C-D).toFixed(2),"userEmail":F.email,"deliverCountry":F.address&&F.address[0]&&F.address[0].countryCode,"estimatedDeliveryDate":F.warehouseInfo&&F.warehouseInfo.etaTime,"ecommerce":{"currencyCode":F.currency,"purchase":{"actionField":{"id":B,"affiliation":w("affiliation")||"","revenue":F.grandTotalPrice,"tax":F.taxPrice,"shipping":F.shippingPrice},"products":G.map(function(L){return{id:L.sku,name:L.name,category:L.category,price:L.salePrice,quantity:L.qty}})}},"isFirstPaidOrder":window.isFirstPaidOrder||false,"singleItemsList":H||[]})},a);function w(C){var D="; "+document.cookie;var E=D.split("; "+C+"=");if(E.length==2){return E.pop().split(";").shift()}}function A(D,C){if(l(D)){return"Device"}else{if(C.isInsurance==="1"){return"Insurance"}else{return C.accessories.length>0?"Bundle":"Accessory"}}}function x(C){return C.salePrice*C.qty-(C.discount||0)}function z(C,D){C.forEach(function(E){if(E.skuType===1){D.push({id:E.sku,quantity:E.qty,price:E.salePrice,discount:E.discount||0});
if(E.accessories&&E.accessories.length>0){z(E.accessories,D)}}else{if(E.skuType===2){if(E.accessories&&E.accessories.length>0){z(E.accessories,D)}}else{return}}})}}function k(w){var x="";location.search.substring(1).split("&").some(function(y){if(y.split("=")[0]==="msg"){x=decodeURIComponent(y.split("=")[1]);return true}});w.push({"event":"transactionFailed","purchaseFailedReason":x})}function f(D){n(function(){return g(".cart-items .cart-item").length>0},function(){var H=x();var G=H.map(function(I){return I.category});D.push({"ecomm_pagetype":"cart","ecomm_value":H.reduce(function(J,I){return J+I.price*I.quantity},0),"ecomm_prodid":H.map(function(I){return I.id}),"ecomm_category":G});F();z();E()},a);function z(){var G=[{selector:".js-num-minus",action:"minus"},{selector:".js-num-add",action:"add"},{selector:".action-remove",action:"remove"}];g(".cart-items")[0].addEventListener("click",function(H){var I=H.target;G.forEach(function(J){if(I.matches(J.selector)){var K=I.classList.contains("disabled");if(!K){var L=r(I,".cart-item");A(J.action,L)}}})})}function A(I,G,J){if(G){var H=y(G);switch(I){case"add":H.quantity=J||1;D.push({"event":"cartIncrease","ecommerce":{"currencyCode":h,"add":{"products":[H]}}});break;case"minus":H.quantity=J||1;D.push({"event":"cartDecrease","ecommerce":{"currencyCode":h,"remove":{"products":[H]}}});break;case"remove":D.push({"event":"cartDelete","ecommerce":{"currencyCode":h,"remove":{"products":[H]}}});break;default:break}}}function F(){var G=g("#final_checkout")[0];G.addEventListener("click",function(){var H=this.href;try{var I=x();D.push({"event":"checkoutStep1-clickCheckout","ecommerce":{"currencyCode":h,"checkout":{"actionField":{"step":1,"option":"Click Checkout"},"products":I}}})}catch(J){}})}function C(L,G){var J=L||window.event;var K=J.target||J.srcElement;if(K.matches(".btn-buy-recom")){var I=r(K,G);var M=I.querySelector("[data-sku]").getAttribute("data-sku");var H=Number(I.querySelector("[data-price]").getAttribute("data-price"));D.push({"event":"addProdToCart","ecomm_prodid":[M],"ecomm_value":H,"ecommerce":{"currencyCode":h,"add":{"products":[{id:M,name:I.querySelector(".info-name").textContent,price:H,quantity:1,dimension1:"In Stock"}]}}})}}function E(){var H=g(".like-goods-list.cart-recommends-pc.row");var G=g(".swiper-wrapper.recommends");Array.prototype.forEach.call(H,function(I){I.addEventListener("click",function(J){C(J,".like-goods-box")})});Array.prototype.forEach.call(G,function(I){I.addEventListener("click",function(J){C(J,".swiper-slide.recommend")})})}function x(){var I=g(".cart-items .cart-item");var G=Array.prototype.map.call(I,function(J){return y(J)});var H=B();return G.concat(H)}function B(){var G=g(".item-recom");return Array.prototype.map.call(G,function(H){return{id:H.getAttribute("data-sku"),name:H.querySelector(".recom-name").textContent,price:Number(H.querySelector(".recom-price .price").getAttribute("data-price")),category:"Insurance",quantity:Number(H.querySelector(".recom-qty input").value),dimension1:"In Stock"}})}function y(G){var H=G.getAttribute("data-sku");return{id:H,name:G.querySelector(".main-name a").textContent,price:Number(G.querySelector(".main-price .price").getAttribute("data-price")),category:w(H,G),quantity:Number(G.querySelector(".main-qty input").value),dimension1:G.querySelector(".main-name").hasAttribute("disabled")?"Out of Stock":"In Stock"}}function w(H,G){if(l(H)){return"Device"}else{if(G.querySelector(".item-recom")){return"Device"}else{return G.querySelector(".item-detail")?"Bundle":"Accessory"}}}}function v(F){n(function(){var I=Array.prototype.reduce.call(g(".sku-option .phone-info h6"),function(K,J){return K+(J&&J.textContent.trim()||"")},"");return I.length>0},function(){D()},a);var B=false;var H=false;var G=false;function D(){var I=Array.prototype.map.call(g(".sku-option .as-phone-info"),function(K){return K});F.push({"event":"loadProductDetail","ecomm_prodid":I.map(function(K){return K.value}),"ecomm_pagetype":"product","ecommerce":{"currencyCode":h,"detail":{"products":I.map(function(K){return{id:K.value,name:K.getAttribute("data-name"),price:Number(K.getAttribute("data-price")),category:"Device",dimension1:K.disabled?"Out of Stock":"In Stock"}})}}});z();var J=g(".puppet.tab-nav-puppet");Array.prototype.forEach.call(J,function(K){K.addEventListener("click",function(){var L=K.getAttribute("for");L==="tab-nav-phone"&&setTimeout(function(){z()});G=L==="tab-nav-recoms"})})}function z(){var I=g(".sku-option .puppet.phone-puppet")||[];Array.prototype.forEach.call(I,function(J){J.addEventListener("click",function(K){var L=K.currentTarget.parentElement.querySelector("input");F.push({"event":"selectModel","model":L&&L.getAttribute("data-name")});setTimeout(function(){if(g("#tab-nav-insurance").length>0){C()}else{G=true;x()}})})})}function C(){var I=g(".btn-continue")||[];Array.prototype.forEach.call(I,function(J){J.addEventListener("click",function(){setTimeout(function(){G=true;if(!H){x()}})})})}function x(){if(!B){E();B=true
}w();y();H=true}function E(){var I=g(".recoms .recom a");Array.prototype.forEach.call(I,function(J){J.addEventListener("click",function(){var O=this.getAttribute("data-sku");var K=g(".recom-overlay[data-code="+O+"]")[0];if(K){var M=K.querySelector("[data-stock]");var L=K.querySelector(".js-name").textContent;var N={id:K.getAttribute("data-code"),name:L&&L.trim(),price:Number(K.getAttribute("data-price")),category:A(K),dimension1:M&&M.getAttribute("data-stock")==1?"In Stock":"Out of Stock"};F.push({"event":"popupAccessoryDetail","ecommerce":{"currencyCode":h,"detail":{"products":N}}})}})})}function w(){var I=g(".recom-overlay .btn-add-to-cart")||[];Array.prototype.forEach.call(I,function(J){J.addEventListener("click",function(L){var M=r(L.target,".recom-overlay");var K=M&&M.querySelector(".header-container .title").textContent;F.push({"event":"addAccessory","model":K})})})}function y(){var I=g(".as-add-to-cart")||[];Array.prototype.forEach.call(I,function(J){J.addEventListener("click",function(){if(!G){return}var K=document.getElementById("data-stats")&&JSON.parse(document.getElementById("data-stats").innerHTML)||null;var L=[];if(K){L=K.phone.list.map(function(M){return{id:M.sku,name:M.name,price:Number(M.discounted),category:"Device",quantity:1}});L=L.concat(K.recoms.list.map(function(M){return{id:M.sku,name:M.name,price:Number(M.discounted),category:A(g('[data-code="'+M.code+'"]')[0]),quantity:1}}));L=L.concat(K.insurance.list.map(function(M){return{id:M.sku,name:M.name,price:Number(M.discounted),category:"Insurance",quantity:1}}));F.push({"event":"addProdToCart","ecomm_value":L.reduce(function(N,M){return N+M.price},0),"ecomm_prodid":L.map(function(M){return M.id}),"ecommerce":{"currencyCode":h,"add":{"products":L}}})}})})}function A(J){if(!J){return""}var I="";if(J.querySelector(".simple-step")){I="Accessory"}else{if(J.querySelector(".series-steps")){I="Series"}else{if(J.querySelector(".bundle-steps")){I="Bundle"}}}return I}}function m(x){var A=document.getElementById("data-recom")&&JSON.parse(document.getElementById("data-recom").innerHTML)||null;var z=A&&(function(C){var B={};B.skus=[];if(C.simple){B.name=C.simple.name;B.category="Accessory";B.skus=B.skus.concat(C.simple.sku)}if(C.series&&C.series.skus){B.name=C.series.name;B.category="Series";B.skus=B.skus.concat(C.series.skus.map(function(D){return D.sku}))}if(C.bundle){B.skus=B.skus.concat(C.bundle.sku);B.name=C.bundle.name;B.category="Bundle"}return B})(A)||[];n(function(){return w()>0},function(){y()},a);function y(){var B=document.querySelector(".btn-add-to-cart");B&&B.addEventListener("click",function(){var E="";if(A&&A.simple){E=document.querySelector(".simple-step .behind-stage-input").value}else{E=document.querySelector(".sku-step .behind-stage-input:checked").value}var D=w();var C=g(".recom-overlay .js-name")[0].textContent;x.push({"event":"addProdToCart","ecomm_prodid":[E],"ecomm_value":D,"ecommerce":{"currencyCode":h,"add":{"products":[{"name":C&&C.trim(),"id":E,"price":D,"quantity":1,"category":z.category,"dimension1":"In Stock"}]}}})});x.push({"ecomm_pagetype":"accessory detail","ecomm_prodid":z.skus,"ecomm_value":w(),"ecomm_category":["Accessory"]});x.push({"event":"loadProductDetail","ecomm_prodid":z.skus,"ecommerce":{"currencyCode":h,"detail":{"products":(function(D){var C;if(D&&D.series){return Array.prototype.map.call(g(".behind-stage .behind-stage-input"),function(E){return{name:E.getAttribute("data-name"),id:E.getAttribute("data-sku"),price:E.getAttribute("data-price"),category:z.category,dimension1:E.getAttribute("data-stock")==1?"In Stock":"Out of Stock"}})}else{C=w();return{name:z.name,id:z.skus&&z.skus[0],price:C,category:z.category,dimension1:C.length>0?"In Stock":"Out of Stock"}}})(A)}}})}function w(){var B=g(".recom-overlay")[0];if(B){return Number(g(".recom-overlay")[0].getAttribute("data-price"))}return 0}}function b(y){var B=document.querySelector(".op-narrow-banner")&&document.querySelector(".op-narrow-banner").querySelectorAll(".banner-column .banner-button, .banner-column .learn-more");var x=document.querySelector(".op-home-promo")&&document.querySelector(".op-home-promo").querySelectorAll(".promo-item .item-link");if(B){var A=Array.prototype.filter.call(B,function(C){return C.innerText.trim()}).map(function(E){var C=E.getAttribute("promocr"),D=E.href,H=D+" | "+E.innerText,G=w(D);var F={id:H,name:G,creative:C,position:E.getAttribute("promops")};E.setAttribute("promonm",G);E.addEventListener("click",function(){y.push({"event":"promotionClick","ecommerce":{"promoClick":{"promotions":[F]}}})});return F})}if(x){var z=Array.prototype.map.call(x,function(E){var C=E.getAttribute("promocr"),D=E.href,H=D+" | "+E.querySelector(".subtitle").innerText,G=w(D);var F={id:H,name:G,creative:C,position:E.getAttribute("promops")};E.setAttribute("promonm",G);E.addEventListener("click",function(){y.push({"event":"promotionClick","ecommerce":{"promoClick":{"promotions":[F]}}})});return F})}if(A&&z){y.push({"event":"loadHome","ecommerce":{"promoView":{"promotions":A.concat(z)}}})
}function w(D){var E=D.match(/https:\/\/(.*)\?.*/),C=E&&E[1].split("/").pop()||"";return C||D}}function u(y){var x=document.querySelector(".accessory-list-banner").querySelectorAll(".swiper-slide");var z=Array.prototype.filter.call(x,function(A){return !A.classList.contains("swiper-slide-duplicate")}).map(function(F){var C=F.querySelector(".link-clean");var A=C.getAttribute("promocr"),B=C.href,G=B,E=w(B);var D={id:G,name:E,creative:A,position:C.getAttribute("promops")};C.setAttribute("promonm",E);C.addEventListener("click",function(){y.push({"event":"promotionClick","ecommerce":{"promoClick":{"promotions":[D]}}})});return D});y.push({"event":"loadProductList","ecommerce":{"promoView":{"promotions":z}}});function w(B){var C=B.match(/https:\/\/(.*)\?.*/),A=C&&C[1].split("/").pop()||"";return A||B}}function l(w){return w&&w.indexOf("501")===0}function i(){var x=location.pathname.split("/");var y=x.concat([]).pop();var w="";if(window.isHome){w="home"}else{if(y==="store"){w="store"}else{if(y==="jcart"){w="jcart"}else{if(y==="onepage"){w="checkout"}else{if(location.pathname.indexOf("jcart/falcon/success")>=0){w="paymentSuccess"}else{if(location.pathname.indexOf("sales/order/history")>=0&&location.search.indexOf("payment_status=error")>=0){w="paymentFail"}else{if(y.indexOf("oneplus-")===0&&document.getElementById("data-device")){w="phoneModels"}else{if(document.getElementById("data-recom")){w="accessoryDetail"}}}}}}}}return w}function d(){var w=document.getElementById("mark-currency-code")?document.getElementById("mark-currency-code").value:"";return w}function e(){if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(x){var y=(this.document||this.ownerDocument).querySelectorAll(x),w=y.length;while(--w>=0&&y.item(w)!==this){}return w>-1}}}function r(x,w){for(;x&&x!==document;x=x.parentNode){if(x.matches(w)){return x}}return null}function n(x,w,y){var A=Date.now();y=y||5000;var z=setInterval(function(){if(Date.now()-A>y||x()){clearInterval(z);w()}},100)}}());