+function(a){"use strict";a(function(){function g(b,c){var i,d=b||window.modules.misc.parseQuery(),f=a("#_net_host").val(),h=a("#_india_host").val();i=c?e?h:f:h,d._ssoid&&a.ajax({type:"post",url:i+"/xman/user/synclogin",data:d,dataType:"json",xhrFields:{withCredentials:!0},timeout:window.AJAX_OPTIONS&&window.AJAX_OPTIONS.timeout,success:function(a){1!=a.ret&&g.tryReconnectCount--&&g(d)},error:function(){window.AJAX_OPTIONS&&modules.misc.dialog.show(window.AJAX_OPTIONS.tips),g.tryReconnectCount--&&g(d)}})}var d,e,f,h,b=window.location.hostname;modules&&modules.misc&&modules.misc.domain||{},d=modules&&modules.misc&&modules.misc.topDomain||{},e=b.indexOf(d.net)>-1,f=b.indexOf("account."+d.net)>-1,g.tryReconnectCount=1,f&&g(),window.modules.syncLoginToIndia=g,h=function(){function j(a){c.addClass("hidden"),d.find(".user-name").text(decodeURIComponent(a)),d.removeClass("hidden"),c.find("form").length&&c.find("form")[0].reset()}var i,k,b=a(".js-off-canvas.js-log-in"),c=b.find(".js-before-logged-in"),d=b.find(".logged-in"),e=a("#offCanvasLoginEmail"),f=a("#offCanvasLoginPassword"),g=a("#offCanvasLogin"),h=a("#offCanvasSignOut");return function(){!function(){var a,b;modules&&modules.misc&&modules.misc.cookieTool&&(a=modules.misc.cookieTool.getItem("ONEPLUSID"),a&&(b=modules.misc.cookieTool.getItem("username"),modules&&modules.misc&&modules.misc.urldecode&&(b=modules.misc.urldecode(b)),j(b)))}()}(),i=function(){var c,b={};b.email=e.val(),b.password=Crypts.RSA.encrypt(f.val()),b.recaptcha=a("#g-recaptcha-response").val(),modules&&modules.misc&&modules.misc.load&&modules.misc.load.start(),c=this,modules&&modules.misc&&(c.trafficControl=new modules.misc.TrafficControl(a(c))),a.ajax({type:"POST",url:ONEPLUS_NET.REQUEST.LOG_IN,data:b,dataType:"json",success:function(b){modules&&modules.misc&&modules.misc.load&&modules.misc.load.finish(),1===b.ret?(c.trafficControl.clear(),j(b.data.username),window.bus&&window.bus.$emit("signed-in")):10086===b.ret?window.location.href=a("#link-sign-in").val()+"?email="+e.val():c.trafficControl.hint(b.errMsg),1===b.ret&&60===b.errCode&&c.trafficControl.init()},timeout:window.AJAX_OPTIONS&&window.AJAX_OPTIONS.timeout,error:function(){window.AJAX_OPTIONS&&modules.misc.dialog.show(window.AJAX_OPTIONS.tips),modules&&modules.misc&&modules.misc.load&&modules.misc.load.finish()}})},k=function(){modules&&modules.misc&&modules.misc.load&&modules.misc.load.start(),a.ajax({type:"GET",url:ONEPLUS_NET.REQUEST.LOG_OUT,dataType:"jsonp",success:function(b){modules&&modules.misc&&modules.misc.load&&modules.misc.load.finish(),1===b.ret?(c.removeClass("hidden"),d.addClass("hidden"),a.ajax({type:"POST",url:ONEPLUS_NET.REQUEST.SIGN_OUT,dataType:"json"}),modules&&modules.misc&&modules.misc.cache&&modules.misc.cache.remove("cart")):modules&&modules.misc&&modules.misc.dialog&&modules.misc.dialog.show(b.errMsg)},timeout:window.AJAX_OPTIONS&&window.AJAX_OPTIONS.timeout,error:function(){window.AJAX_OPTIONS&&modules.misc.dialog.show(window.AJAX_OPTIONS.tips),modules&&modules.misc&&modules.misc.load&&modules.misc.load.finish()}})},g.on("inputValidated.oneplus",function(a){a.preventDefault(),a.stopPropagation(),i.call(this)}),h.on("click",function(a){a.preventDefault(),a.stopPropagation(),k()}),{AUTHOR:"Michael",VERSION:"1.0.0",LAST_MODIFIED:"2015-07-23",$element:b}}(),window.modules=window.modules||{},window.modules.login=h})}(jQuery);